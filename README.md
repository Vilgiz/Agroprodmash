# Agroprodmash

Если есть траблы - звони/пиши. Готов к удаленному управлению, если это будет необходимо

## Последовательность действий

- [Скачать себе репозиторий](#Скачать-себе-репозиторий)
- [Установить библиотеки из него в виртуальное пространство](#Установить-библиотеки-из-него-в-виртуальное-пространство)
- [Подсосаться к роботу](#Подсосаться-к-роботу)
- [Калибровка света и яркости(ползунки)](#Калибровка-света-и-яркости(ползунки))
- [Калибровка цвета и логотипа робовизард(ползунки)](#Калибровка-цвета-и-логотипа-робовизард(ползунки))
- [Калибровка Хафа(ползунки)](#Калибровка-Хафа(ползунки))
- [Калибровка координат Питон](#Калибровка-координат-Питон)
- [Калибровка координат AS](#Калибровка-координат-AS)
- [Калибровка предсказания](#Калибровка-предсказания)
- [amcap.exe](#amcap.exe)
- [Траблшутинг](#Траблшутинг)
- [Источники](#Источники)

## Скачать себе репозиторий

Скачиваешь или клонируешь репозиторий

(кнопка Code -> download ZIP)

Папка должна выглядить так:

![Вот так](https://github.com/Vilgiz/Agroprodmash/raw/main/1.png)

1.png

## Установить библиотеки из него в виртуальное пространство

Установи все библиотеки из myenv - если не знаешь как, спроси у chatgpt - он понятнее и подробнее объяснит

## Подсосаться к роботу

Проверь соединение - запусти Comp_vision.py и проверь с одной банкой, что все приходит на робота, а на питоне все отображается и не вылетает - это значит что все установлено правильно

## Калибровка света и яркости(ползунки)

Раскомменти это и ты увидишь ползунки после запуска файла

```typescript
# ? cv2.createTrackbar('brightness_factor', 'Video', 1, 2000, self.__onbrightness_factor)
# ? cv2.createTrackbar('contrast_factor', 'Video', 1, 2000, self.__onContrast_factor)
# ? cv2.createTrackbar('saturation_factor', 'Video', 1, 2000, self.__onsaturation_factor)
```

Потом полученные значения раздели на 1000 и запиши сюда

```typescript
self.brightness_factor = 0.725;
self.contrast_factor = 1.661;
self.saturation_factor = 1.371;
```

Потом закоменти это обратно (ВАЖНО)

## Калибровка цвета и логотипа робовизард(ползунки)

Раскомменти это и ты увидишь ползунки после запуска файла

```typescript
# ? cv2.createTrackbar('__B_color_low', 'Video', 1, 254, self.__B_color_low)
# ? cv2.createTrackbar('__R_color_low', 'Video', 1, 254, self.__R_color_low)
# ? cv2.createTrackbar('__G_color_low', 'Video', 1, 254, self.__G_color_low)
# ? cv2.createTrackbar('__B_color_hight', 'Video', 1, 254, self.__B_color_hight)
# ? cv2.createTrackbar('__R_color_hight', 'Video', 1, 254, self.__R_color_hight)
# ? cv2.createTrackbar('__G_color_hight', 'Video', 1, 254, self.__G_color_hight)
```

поставь банку с робовизардом перед камерой и крути верхние, отталкиваясь от значений ниже, чаще всего 5 и 6 в максимум, а 4 придется покрутить от 1 до 10 примерно, но это не факт, так было на заводе и у меня дома )0)0)

нужно добиться того, чтобы на малеком окошке (который открывает тебе питон, после того как найдет банку без лого) на банке с лого был видел только красный лого (он будет отображен белым)

Потом полученные значения запиши сюда

```typescript
self.B_color_low = 1;
self.R_color_low = 1;
self.G_color_low = 1;
self.B_color_hight = 4;
self.R_color_hight = 254;
self.G_color_hight = 254;
```

Потом закоменти это обратно (ВАЖНО)

## Калибровка Хафа(ползунки)

!!!!!!!!!!ТРОГАТЬ ТОЛЬКО ЕСЛИ БУДЕТ ПЛОХО ДЕТЕКТИТЬ БАНКИ!!!!!!!!!!

Раскомменти это и ты увидишь ползунки после запуска файла

```typescript
# ? cv2.createTrackbar('param1', 'Video', 1, 1000, self.__onChange1)
# ? cv2.createTrackbar('param2', 'Video', 1, 1000, self.__onChange2)
```

Рандомно крутишь ползунки, пока не добьешься нужного эффекта

Потом полученные значения раздели на 1000 и запиши сюда

```typescript
self.param1 = 1
self.param2 = 0.545  # 0.43
```

Потом закоменти это обратно (ВАЖНО)

## Калибровка координат Питон

Оставим калибровку на преждем уровне, относительно робота левый нижний угол - туда тул и запоминаешь точку, на питоне - запускаешь calibration_old.py, предвательно поставив перед камерой aruco marker
с ID 0!
Он должен быть размером как в файле:

```typescript
real_dlina = 58;
```

это в миллиметрах

расположи маркер так, что на получившимся фото фиолетовая линия была с правой стороны квадрата

## Калибровка координат AS

На as у нас были костыли к коррекции движения при высчитытывании координат, их точно надо уточнить, и, возможно, они будут в разы меньше

## Калибровка предсказания

Параметр количества измерений

---СТРОЧКА 39---

```typescript
self.size = 16
```

ВЛИЯЕТ НА: 
    - сколько точек захватим
ЗАВИСИТ ОТ: 
    - скорости конвейера

Параметр дальность предсказания

---СТРОЧКА 259---

```typescript
self.distance_of_prediction = 520 + self.cofficient
```
ты задаешь 520 - количество пикселей на которое мы предсказываем от левого края камеры (ширина камеры ~620) 

ВЛИЯЕТ НА: 
    - расстояние предсказания

Параметр величины коррекции по времени (твоя фича)

---СТРОЧКА 334---

```typescript
return int(self.cofficient/10)    
```

ты задаешь /10 - в разах, чем больше - тем меньше эффект калибровки и наоброт, сейчас стоит достаточно малекий

ВЛИЯЕТ НА: 
    - коррекцию по времени захвата банки



![пример](https://github.com/Vilgiz/Agroprodmash/raw/main/2.png)

Крч:
    - зеленая линия - траектория
    - красная точка - точка, которую мы пресказали
    - синие точки - захваченная и записанная траектория движения банки
    - красные линие - первая синяя точка и последняя



self.right_predcition = (x,y) - можно проверить на всякий, что хранится тут, если будет слать херню

## amcap.exe

Перед запуском на чистовую надо запустить файл amcap.exe

Devices -> выбрать камеру -> Options -> Video capture vilter -> найти калибровку фокуса и выдержки -> отключить режим авто-> сделать красиво

## Траблшутинг

## Источники

ChatGPT

```sh
$ npm i your-awesome-plugin-name
```

```typescript
import { hi } from "your-awesome-plugin-name";

hi(); // Выведет в консоль "Привет!"
```

```sh
npm run test
```
